<%= stylesheet_link_tag "jquery.rateyo.min.css", :media => "all" %>
<div class="col-xs-12 col-md-8 col-md-offset-2">
  <% if @orderd_items.blank?%>
  <p>まだ注文された商品はありません(商品購入後レビューできます)</p>
  <% else %>
  <p>購入済みの商品</p>
  <% @orderd_items.each do |item| %>
  <div class="review-lists">
    <div class="row">
      <div class="col-xs-10 col-xs-offset-1">
        <% @reviews.each do |review| %>
          <% if item.id == review.item_id %>
          <%# レビュー済みの商品を表示 %>
          <div class="review-list row">
            <div class="review-img col-xs-5 col-md-5">
              <%= image_tag review.item.mainImage.url, class: 'img-responsive'%>
            </div>
            <div class="review-detail col-xs-7 col-md-7">
              <div class="review-content">
                <%# 商品名 %>
                <div class="item-content">
                  <%= review.item.itemName.truncate(13) %>
                </div>
                <%# 評価表示 %>
                <div class="item-content">
                  <div id="rateYo-<%= review.id %>" data-star="<%= review.score %>"></div>
                </div>
                <%# <div>truncate(review.comment, length: 20)</div> %>
                <div>
                  <%= link_to '評価する', review_path(review.item.id), class: 'btn btn-primary btn-sm' %>
                </div>
              </div>
            </div>
            <% @reviewed_flg = true %>
          </div>
          <% end %>
        <% end %>
        <% unless @reviewed_flg == true %>
          <div class="review-list row">
            <div class="review-img col-xs-5">
              <%= image_tag item.mainImage.url, class: 'img-responsive' %>
            </div>
            <div class="col-xs-7 review-detail">
              <div class="review-content">
                <div class="item-content"><%=  item.itemName %></div>
                <div class="item-content">未評価</div>
                <div><%= link_to '評価する', review_path(item.id), class: 'btn btn-primary' %></div>
              </div>
            </div>
          </div>
        <% end %>
        <%# binding.pry %>
        <% @reviewed_flg = false %>
      </div>
    </div>
  </div>
  <% end %>
  <% end %>
</div>


<%= javascript_include_tag 'jquery.rateyo.min.js', 'data-turbolinks-track': 'true' %>

<%= hidden_field_tag 'review_array', @reviews.pluck(:id) %>
<script>
  review_array = $('#review_array').val().split(' ')
  $.each(review_array, function(idx, value){
    $(function(){
      $("#rateYo-" + value).rateYo({
        starWidth: "20px",
        rating: $("#rateYo-" + value).data('star'),
        fullStar: true,
        readOnly: true
      })
    })
  })
</script>
